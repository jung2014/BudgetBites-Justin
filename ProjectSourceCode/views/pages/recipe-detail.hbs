<div class="container py-4">
  <a href="/discover" class="btn btn-link mb-3">&larr; Back to Discover</a>

  {{#if error}}
  <div class="alert alert-danger">{{error}}</div>
  {{/if}}

  {{#if recipe}}
  <div class="card shadow-sm mb-4">
    {{#if recipe.image}}
    <img src="{{recipe.image}}" class="card-img-top" alt="{{recipe.title}}" style="max-height: 380px; object-fit: cover;">
    {{/if}}
    <div class="card-body">
      <div class="d-flex flex-wrap justify-content-between align-items-start gap-3 mb-3">
        <div>
          <h1 class="card-title mb-2">{{recipe.title}}</h1>
          {{#if recipe.summary}}
          <p class="text-muted mb-0">{{recipe.summary}}</p>
          {{/if}}
        </div>
        <div class="d-flex flex-wrap gap-2">
          {{#if recipe.readyInMinutes}}
          <span class="badge text-bg-primary">
            <i class="bi bi-stopwatch me-1"></i>{{recipe.readyInMinutes}} min
          </span>
          {{/if}}
          {{#if recipe.servings}}
          <span class="badge text-bg-secondary">
            <i class="bi bi-people me-1"></i>Serves {{recipe.servings}}
          </span>
          {{/if}}
          {{#if recipe.pricePerServing}}
          <span class="badge text-bg-success">
            <i class="bi bi-wallet2 me-1"></i>${{recipe.pricePerServing}} / serving
          </span>
          {{/if}}
        </div>
      </div>

      <div class="d-flex flex-wrap gap-3 mb-3">
        <form method="POST" action="{{#if isFavorite}}/favorites/remove{{else}}/favorites/add{{/if}}">
          <input type="hidden" name="recipeId" value="{{recipe.id}}">
          <input type="hidden" name="redirectTo" value="/recipes/{{recipe.id}}">
          <button type="submit" class="btn {{#if isFavorite}}btn-warning{{else}}btn-outline-warning{{/if}}">
            {{#if isFavorite}}
            <i class="bi bi-heartbreak me-1"></i>Remove Favorite
            {{else}}
            <i class="bi bi-heart me-1"></i>Save to Favorites
            {{/if}}
          </button>
        </form>
        <form method="POST" action="/discover/grocery-list">
          <input type="hidden" name="recipeIds[]" value="{{recipe.id}}">
          <button type="submit" class="btn btn-success">
            <i class="bi bi-basket me-1"></i>Add to Grocery List
          </button>
        </form>
        {{#if recipe.sourceUrl}}
        <a href="{{recipe.sourceUrl}}" target="_blank" class="btn btn-outline-primary">
          <i class="bi bi-box-arrow-up-right me-1"></i>View Original
        </a>
        {{/if}}
      </div>
    </div>
  </div>

  <div class="row g-4">
    <div class="col-lg-4">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h4 class="card-title mb-3">Ingredients</h4>
          {{#if recipe.extendedIngredients}}
          <ul class="list-group list-group-flush">
            {{#each recipe.extendedIngredients}}
            <li class="list-group-item">
              <strong>{{name}}</strong>
              <div class="text-muted small">{{original}}</div>
            </li>
            {{/each}}
          </ul>
          {{else}}
          <p class="text-muted mb-0">No ingredient data available.</p>
          {{/if}}
        </div>
      </div>
    </div>
    <div class="col-lg-8">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h4 class="card-title mb-3">Instructions</h4>
          {{#if instructions.length}}
          <ol class="list-group list-group-numbered">
            {{#each instructions}}
            <li class="list-group-item">
              {{description}}
            </li>
            {{/each}}
          </ol>
          {{else}}
          <p class="text-muted mb-0">No instructions available for this recipe.</p>
          {{/if}}
        </div>
      </div>
    </div>
  </div>

  {{#if recipe.nutrition}}
  <div class="card shadow-sm mt-4">
    <div class="card-body">
      <h4 class="card-title mb-3">Nutrition</h4>
      <div class="row">
        {{#each recipe.nutrition.nutrients}}
        {{#if (or (eq name "Calories") (eq name "Protein") (eq name "Fat") (eq name "Carbohydrates"))}}
        <div class="col-6 col-md-3 mb-3">
          <div class="border rounded p-3 text-center">
            <p class="mb-1 text-muted small">{{name}}</p>
            <p class="mb-0 h5">{{amount}} {{unit}}</p>
          </div>
        </div>
        {{/if}}
        {{/each}}
      </div>
    </div>
  </div>
  {{/if}}
  {{/if}}
</div>
